<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>3D GitHub Contributions</title>
  <style>
    body { margin: 0; background: #111; overflow: hidden; font-family: sans-serif; }
    #info { position: absolute; top: 10px; left: 10px; color: white; z-index: 1; }
  </style>
</head>
<body>
  <div id="info">github.com/PEZ</div>
  <script src="https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.min.js"></script>
  <script>
    const dataUrl = "pez-github-contributions-2024-03-29.json"; // Assumes data is served in same dir

    async function main() {
      const response = await fetch(dataUrl);
      const json = await response.json();
      const weeks = json.data.user.contributionsCollection.contributionCalendar.weeks;

      // Flatten all days
      const allDays = weeks.flatMap(week => week.contributionDays.map(day => ({
        date: new Date(day.date),
        count: day.contributionCount
      })));

      // Organize by month
      const months = {};
      allDays.forEach(day => {
        const monthKey = day.date.getFullYear() + "-" + (day.date.getMonth() + 1).toString().padStart(2, '0');
        if (!months[monthKey]) months[monthKey] = [];
        months[monthKey].push(day);
      });

      // THREE.js setup
      const scene = new THREE.Scene();
      const camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 1000);
      camera.position.set(-40, 50, 100);
      camera.lookAt(0, 0, 0);

      const renderer = new THREE.WebGLRenderer({ antialias: true });
      renderer.setSize(window.innerWidth, window.innerHeight);
      document.body.appendChild(renderer.domElement);

      const light = new THREE.DirectionalLight(0xffffff, 1);
      light.position.set(1, 2, 3);
      scene.add(light);

      // Color scale similar to GitHub
      const getColor = (count) => {
        if (count === 0) return 0xebedf0;
        if (count < 10) return 0xc6e48b;
        if (count < 20) return 0x7bc96f;
        if (count < 30) return 0x239a3b;
        return 0x196127;
      };

      const boxGeo = new THREE.BoxGeometry(1, 1, 1);
      let col = 0;
      for (const [month, days] of Object.entries(months)) {
        days.forEach(day => {
          const weekday = day.date.getDay(); // Sunday = 0
          const height = Math.max(day.count * 0.1, 0.1);
          const mat = new THREE.MeshLambertMaterial({ color: getColor(day.count) });
          const box = new THREE.Mesh(boxGeo, mat);
          box.scale.set(0.9, height, 0.9);
          box.position.set(col * 1.2, height / 2, weekday * 1.2);
          scene.add(box);
        });
        col++;
      }

      // Animate
      function animate() {
        requestAnimationFrame(animate);
        renderer.render(scene, camera);
      }
      animate();
    }

    main();
  </script>
</body>
</html>